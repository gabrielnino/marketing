<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tricolor Fan Club — News Engine (MVP) • Playbook</title>
    <meta name="color-scheme" content="dark" />
    <style>
        :root {
            --bg0: #070b14;
            --bg1: #0b1220;
            --panel: #0f1a2e;
            --panel2: #101f38;
            --text: #e8eefc;
            --muted: #9fb0d4;
            --line: rgba(255,255,255,.10);
            --accent: #7c5cff; /* púrpura */
            --accent2: #2dd4ff; /* cian */
            --good: #3ddc97;
            --warn: #ffcc66;
            --bad: #ff5c7a;
            --shadow: 0 18px 55px rgba(0,0,0,.45);
            --shadow2: 0 10px 30px rgba(0,0,0,.35);
            --r: 18px;
            --r2: 14px;
            --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
        }

        * {
            box-sizing: border-box
        }

        html, body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: var(--sans);
            color: var(--text);
            background: radial-gradient(1200px 600px at 18% 8%, rgba(124,92,255,.18), transparent 60%), radial-gradient(900px 500px at 82% 18%, rgba(45,212,255,.12), transparent 60%), radial-gradient(900px 700px at 50% 100%, rgba(61,220,151,.08), transparent 62%), linear-gradient(180deg, var(--bg0), var(--bg1) 32%, #0a1020);
            line-height: 1.35;
            overflow-x: hidden;
        }

        a {
            color: inherit
        }

        .mono {
            font-family: var(--mono)
        }

        .muted {
            color: var(--muted)
        }

        .sr {
            position: absolute;
            left: -9999px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        /* Topbar */
        .topbar {
            position: sticky;
            top: 0;
            z-index: 60;
            backdrop-filter: blur(14px);
            background: linear-gradient(to bottom, rgba(7,11,20,.92), rgba(7,11,20,.60));
            border-bottom: 1px solid var(--line);
        }

        .topbar-inner {
            max-width: 1400px;
            margin: 0 auto;
            padding: 14px 18px;
            display: flex;
            gap: 14px;
            align-items: center;
            justify-content: space-between;
        }

        .brand {
            display: flex;
            gap: 12px;
            align-items: center;
            min-width: 320px
        }

        .logo {
            width: 42px;
            height: 42px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(45,212,255,.95));
            box-shadow: 0 14px 40px rgba(124,92,255,.20);
            display: grid;
            place-items: center;
            font-weight: 900;
            letter-spacing: .6px;
            user-select: none;
        }

        .brand h1 {
            font-size: 13px;
            margin: 0
        }

        .brand p {
            font-size: 12px;
            margin: 2px 0 0;
            color: var(--muted)
        }

        .search {
            flex: 1;
            display: flex;
            gap: 10px;
            align-items: center;
            max-width: 700px;
            background: rgba(255,255,255,.045);
            border: 1px solid var(--line);
            border-radius: 16px;
            padding: 10px 12px;
        }

            .search input {
                flex: 1;
                border: 0;
                outline: 0;
                background: transparent;
                color: var(--text);
                font-size: 13px;
            }

        .kbd {
            font-size: 11px;
            color: var(--muted);
            border: 1px solid rgba(255,255,255,.16);
            padding: 3px 7px;
            border-radius: 10px;
            background: rgba(0,0,0,.18);
            font-family: var(--mono);
            user-select: none;
        }

        .tag {
            display: inline-flex;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid var(--line);
            font-size: 11px;
            color: var(--muted);
            background: rgba(255,255,255,.03);
            white-space: nowrap;
        }

            .tag.good {
                border-color: rgba(61,220,151,.35);
                color: rgba(61,220,151,.95);
                background: rgba(61,220,151,.08)
            }

            .tag.warn {
                border-color: rgba(255,204,102,.35);
                color: rgba(255,204,102,.95);
                background: rgba(255,204,102,.08)
            }

            .tag.bad {
                border-color: rgba(255,92,122,.35);
                color: rgba(255,92,122,.95);
                background: rgba(255,92,122,.08)
            }

            .tag.accent {
                border-color: rgba(124,92,255,.50);
                color: rgba(232,238,252,.92);
                background: rgba(124,92,255,.10)
            }

        .pillbar {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .pill {
            display: inline-flex;
            gap: 8px;
            align-items: center;
            padding: 9px 12px;
            border-radius: 999px;
            border: 1px solid var(--line);
            background: rgba(255,255,255,.03);
            color: var(--muted);
            font-size: 12px;
            cursor: pointer;
            user-select: none;
            transition: transform .08s ease, border-color .2s ease, background .2s ease;
            white-space: nowrap;
        }

            .pill:hover {
                border-color: rgba(255,255,255,.20);
                background: rgba(255,255,255,.05)
            }

            .pill:active {
                transform: scale(.98)
            }

            .pill.on {
                border-color: rgba(124,92,255,.70);
                background: rgba(124,92,255,.14);
                color: var(--text);
            }

        /* Layout */
        .wrap {
            max-width: 1400px;
            margin: 18px auto;
            padding: 0 18px 28px;
            display: grid;
            grid-template-columns: 380px 1fr 420px;
            gap: 16px;
            align-items: start;
        }

        @media (max-width: 1240px) {
            .wrap {
                grid-template-columns: 380px 1fr
            }

            .rightcol {
                grid-column: 1 / -1
            }
        }

        @media (max-width: 920px) {
            .wrap {
                grid-template-columns: 1fr
            }

            .brand {
                min-width: unset
            }

            .search {
                display: none
            }

            .pillbar {
                display: none
            }
        }

        .card {
            background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.03));
            border: 1px solid var(--line);
            border-radius: var(--r);
            box-shadow: var(--shadow2);
            overflow: hidden;
        }

        .card-h {
            padding: 14px 14px 10px;
            border-bottom: 1px solid var(--line);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
        }

            .card-h h2 {
                margin: 0;
                font-size: 13px;
                letter-spacing: .2px
            }

            .card-h small {
                color: var(--muted);
                font-size: 12px
            }

        .card-b {
            padding: 14px
        }

        .row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap
        }

        .col {
            display: flex;
            flex-direction: column;
            gap: 10px
        }

        .sep {
            height: 1px;
            background: var(--line);
            margin: 12px 0
        }

        .btn {
            display: inline-flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
            padding: 10px 12px;
            border-radius: 14px;
            border: 1px solid var(--line);
            background: rgba(255,255,255,.04);
            color: var(--text);
            font-size: 12px;
            cursor: pointer;
            transition: transform .08s ease, border-color .2s ease, background .2s ease;
        }

            .btn:hover {
                border-color: rgba(255,255,255,.20);
                background: rgba(255,255,255,.06)
            }

            .btn:active {
                transform: scale(.98)
            }

            .btn.primary {
                border-color: rgba(124,92,255,.70);
                background: linear-gradient(135deg, rgba(124,92,255,.25), rgba(45,212,255,.16));
            }

            .btn.danger {
                border-color: rgba(255,92,122,.55);
                background: rgba(255,92,122,.10)
            }

            .btn.ghost {
                background: rgba(0,0,0,.10)
            }

            .btn:focus-visible, .pill:focus-visible, .tabs button:focus-visible, .accordion summary:focus-visible {
                outline: 2px solid rgba(45,212,255,.55);
                outline-offset: 2px;
            }

        .note {
            border-left: 3px solid rgba(124,92,255,.75);
            padding: 10px 12px;
            background: rgba(124,92,255,.10);
            border-radius: 12px;
            color: var(--muted);
            font-size: 12px;
        }

        .grid2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px
        }

        @media (max-width: 1240px) {
            .grid2 {
                grid-template-columns: 1fr 1fr
            }
        }

        @media (max-width: 520px) {
            .grid2 {
                grid-template-columns: 1fr
            }
        }

        .kpi {
            padding: 12px;
            border: 1px solid var(--line);
            border-radius: 16px;
            background: rgba(0,0,0,.12);
        }

            .kpi .n {
                font-size: 18px;
                font-weight: 900;
                letter-spacing: .3px
            }

            .kpi .t {
                font-size: 12px;
                color: var(--muted)
            }

            .kpi .s {
                font-size: 12px;
                margin-top: 6px;
                color: var(--muted)
            }

        /* Tabs (left) */
        .tabs {
            display: flex;
            gap: 8px;
            padding: 10px 14px;
            border-bottom: 1px solid var(--line);
            background: rgba(0,0,0,.10);
        }

            .tabs button {
                flex: 1;
                border: 1px solid var(--line);
                background: rgba(255,255,255,.03);
                color: var(--muted);
                border-radius: 14px;
                padding: 10px 10px;
                font-size: 12px;
                cursor: pointer;
                transition: border-color .2s ease, background .2s ease, transform .08s ease;
            }

                .tabs button:hover {
                    border-color: rgba(255,255,255,.20);
                    background: rgba(255,255,255,.05)
                }

                .tabs button:active {
                    transform: scale(.99)
                }

                .tabs button.on {
                    border-color: rgba(124,92,255,.70);
                    color: var(--text);
                    background: rgba(124,92,255,.14);
                }

        .tabpane {
            display: none
        }

            .tabpane.on {
                display: block
            }

        /* Accordion (playbook) */
        details.accordion {
            border: 1px solid var(--line);
            border-radius: 16px;
            background: rgba(0,0,0,.12);
            overflow: hidden;
        }

            details.accordion summary {
                list-style: none;
                cursor: pointer;
                padding: 12px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 10px;
                user-select: none;
            }

                details.accordion summary::-webkit-details-marker {
                    display: none
                }

        .acc-title {
            display: flex;
            flex-direction: column;
            gap: 2px
        }

            .acc-title b {
                font-size: 12px
            }

            .acc-title span {
                font-size: 12px;
                color: var(--muted)
            }

        .acc-body {
            padding: 0 12px 12px;
            color: var(--text);
            font-size: 13px
        }

            .acc-body p {
                margin: 8px 0
            }

            .acc-body ul {
                margin: 8px 0 0 18px;
                color: var(--muted)
            }

            .acc-body li {
                margin: 6px 0
            }

        .acc-ico {
            width: 24px;
            height: 24px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,.14);
            background: rgba(255,255,255,.04);
            display: grid;
            place-items: center;
            color: var(--muted);
            flex: 0 0 auto;
        }

        details[open] .acc-ico {
            color: var(--text);
            border-color: rgba(124,92,255,.60);
            background: rgba(124,92,255,.10)
        }

        /* Feed */
        .feed {
            height: calc(100vh - 124px);
            overflow: auto;
            padding: 14px;
            scroll-behavior: smooth;
        }

        @media (prefers-reduced-motion: reduce) {
            .feed {
                scroll-behavior: auto
            }

            .pill, .btn, .tabs button {
                transition: none
            }
        }

        .feed::-webkit-scrollbar {
            width: 10px
        }

        .feed::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,.10);
            border-radius: 999px
        }

        .feed-item {
            border: 1px solid var(--line);
            border-radius: 16px;
            padding: 12px;
            background: rgba(0,0,0,.14);
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }

            .feed-item::before {
                content: "";
                position: absolute;
                inset: 0;
                background: radial-gradient(900px 180px at 20% 0%, rgba(124,92,255,.10), transparent 55%), radial-gradient(800px 160px at 85% 15%, rgba(45,212,255,.08), transparent 55%);
                opacity: .9;
                pointer-events: none;
            }

            .feed-item > * {
                position: relative
            }

        .feed-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 8px;
        }

        .feed-title {
            font-weight: 900;
            font-size: 13px;
            margin: 0;
            letter-spacing: .2px
        }

        .feed-meta {
            font-size: 12px;
            color: var(--muted);
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap
        }

        .feed-body {
            font-size: 13px;
            color: var(--text);
            margin: 8px 0 10px
        }

        .feed-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap
        }

        .badge {
            display: inline-flex;
            gap: 8px;
            align-items: center;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,.12);
            background: rgba(0,0,0,.14);
            color: var(--muted);
            font-size: 11px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 99px;
            display: inline-block
        }

        .toast {
            position: fixed;
            right: 14px;
            bottom: 14px;
            z-index: 99;
            width: min(420px, calc(100% - 28px));
            background: rgba(15,26,46,.94);
            border: 1px solid var(--line);
            border-radius: 16px;
            padding: 12px 12px;
            box-shadow: var(--shadow);
            display: none;
        }

            .toast.show {
                display: block
            }

            .toast .t {
                font-weight: 900;
                font-size: 13px;
                margin: 0
            }

            .toast .m {
                margin: 6px 0 0;
                color: var(--muted);
                font-size: 12px
            }

        /* Right: diagram + charts */
        .svgbox {
            border: 1px solid var(--line);
            border-radius: 16px;
            background: rgba(0,0,0,.12);
            padding: 10px;
            overflow: hidden;
        }

        .legend {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 10px;
            color: var(--muted);
            font-size: 12px;
        }

        /* Utility */
        .hint {
            font-size: 12px;
            color: var(--muted);
            display: flex;
            gap: 8px;
            align-items: center;
        }
    </style>
</head>

<body>
    <div class="topbar" role="banner">
        <div class="topbar-inner">
            <div class="brand" aria-label="Marca">
                <div class="logo" aria-hidden="true">LN</div>
                <div>
                    <h1>Tricolor Fan Club — Motor de Contenido (MVP)</h1>
                    <p>Noticias relevantes → conversación → CTA natural (camisetas)</p>
                </div>
            </div>

            <div class="search" title="Buscar en el feed (cliente)">
                <span style="opacity:.8" aria-hidden="true">⌕</span>
                <label class="sr" for="q">Buscar en el feed</label>
                <input id="q" autocomplete="off" placeholder="Buscar: convocatoria, Vancouver, James, camiseta..." />
                <span class="tag mono" id="qCount" title="Longitud de búsqueda">0</span>
                <span class="kbd" title="Atajo de teclado">/</span>
            </div>

            <div class="pillbar" aria-label="Filtros de intención">
                <div class="pill on" tabindex="0" role="button" aria-pressed="true" data-filter="ALL">Todo</div>
                <div class="pill" tabindex="0" role="button" aria-pressed="false" data-filter="IDENTITY">Identidad</div>
                <div class="pill" tabindex="0" role="button" aria-pressed="false" data-filter="CURRENT">Actualidad</div>
                <div class="pill" tabindex="0" role="button" aria-pressed="false" data-filter="COMMUNITY">Comunidad</div>
                <div class="pill" tabindex="0" role="button" aria-pressed="false" data-filter="PROMO">Promo</div>
            </div>
        </div>
    </div>

    <main class="wrap" role="main">
        <!-- LEFT: Strategy + Playbook -->
        <section class="card" aria-label="Estrategia y Playbook">
            <div class="card-h">
                <div>
                    <h2>Estrategia</h2>
                    <small>Storytelling + Playbook ejecutable (MVP)</small>
                </div>
                <span class="tag good">OPERABLE</span>
            </div>

            <div class="tabs" role="tablist" aria-label="Pestañas">
                <button id="tabStory" class="on" role="tab" aria-selected="true" aria-controls="paneStory">Storytelling</button>
                <button id="tabPlay" role="tab" aria-selected="false" aria-controls="panePlay">Playbook</button>
                <button id="tabOps" role="tab" aria-selected="false" aria-controls="paneOps">Operación</button>
            </div>

            <div class="card-b col">
                <!-- Storytelling -->
                <div id="paneStory" class="tabpane on" role="tabpanel" aria-labelledby="tabStory">
                    <div class="note">
                        <strong>Idea central:</strong> “Aunque estemos lejos, seguimos conectados por la Tricolor.”
                        <div style="margin-top:6px">La camiseta es el <em>artefacto de pertenencia</em>, no solo un producto.</div>
                    </div>

                    <div class="sep"></div>

                    <div class="grid2">
                        <div class="kpi">
                            <div class="t">Core del MVP</div>
                            <div class="n">2 NEWS → 1 PROMO</div>
                            <div class="s">Por grupo/persona (con cooldown)</div>
                        </div>
                        <div class="kpi">
                            <div class="t">Meta real</div>
                            <div class="n">Respuestas</div>
                            <div class="s">No “mensajes enviados”</div>
                        </div>
                    </div>

                    <div class="sep"></div>

                    <div class="col" aria-label="Intenciones">
                        <div class="row">
                            <span class="tag accent">IDENTITY</span>
                            <span class="muted">Orgullo / historia / símbolos compartidos</span>
                        </div>
                        <div class="row">
                            <span class="tag accent">CURRENT</span>
                            <span class="muted">Actualidad emocional (partido, lesión, polémica)</span>
                        </div>
                        <div class="row">
                            <span class="tag accent">COMMUNITY</span>
                            <span class="muted">Colombianos afuera / eventos / watch parties</span>
                        </div>
                        <div class="row">
                            <span class="tag warn">PROMO</span>
                            <span class="muted">CTA natural: “para los que preguntan…”</span>
                        </div>
                    </div>

                    <div class="sep"></div>

                    <div class="hint">
                        <span class="tag mono">Regla</span>
                        <span>El guía no protagoniza: primero vínculo, luego intercambio.</span>
                    </div>
                </div>

                <!-- Playbook -->
                <div id="panePlay" class="tabpane" role="tabpanel" aria-labelledby="tabPlay">
                    <div class="note">
                        <strong>Principio rector:</strong> nunca vender antes de activar identidad o conversación. La venta <em>responde</em>.
                    </div>

                    <div class="sep"></div>

                    <details class="accordion" open>
                        <summary>
                            <div class="acc-title">
                                <b>0) Objetivo real (KPI)</b>
                                <span>Respuestas > envíos</span>
                            </div>
                            <div class="acc-ico" aria-hidden="true">⌁</div>
                        </summary>
                        <div class="acc-body">
                            <p><span class="tag bad">NO</span> “mensajes enviados”</p>
                            <p><span class="tag good">SÍ</span> <b>respuestas</b> y conversación entre iguales.</p>
                        </div>
                    </details>

                    <details class="accordion">
                        <summary>
                            <div class="acc-title">
                                <b>1) Arquitectura 2→1</b>
                                <span>2 NEWS antes de 1 PROMO</span>
                            </div>
                            <div class="acc-ico" aria-hidden="true">⌁</div>
                        </summary>
                        <div class="acc-body">
                            <p>Secuencia por ciclo: <b>NEWS</b> (IDENTITY/CURRENT/COMMUNITY) → <b>NEWS</b> → <b>PROMO</b>.</p>
                            <ul>
                                <li>Nunca dos PROMO seguidas.</li>
                                <li>Nunca PROMO sin NEWS previas.</li>
                            </ul>
                        </div>
                    </details>

                    <details class="accordion">
                        <summary>
                            <div class="acc-title">
                                <b>2) Tipos de contenido</b>
                                <span>Qué publicar (plantillas)</span>
                            </div>
                            <div class="acc-ico" aria-hidden="true">⌁</div>
                        </summary>
                        <div class="acc-body">
                            <p><span class="tag accent">IDENTITY</span> Memoria compartida + pregunta abierta.</p>
                            <p class="muted mono">“¿Cuál fue tu camiseta más inolvidable (año/torneo)?”</p>

                            <p><span class="tag accent">CURRENT</span> Tema actual + opinión dividible.</p>
                            <p class="muted mono">“Si hoy hubiera partido, ¿a quién pones de 9 y por qué?”</p>

                            <p><span class="tag accent">COMMUNITY</span> Localización + encuentro.</p>
                            <p class="muted mono">“Vancouver: ¿en qué zona te queda mejor un watch party?”</p>

                            <p><span class="tag warn">PROMO</span> Solo después de 2 NEWS con respuestas. Lenguaje pasivo.</p>
                            <p class="muted mono">“Para los que preguntan 👕: hay camisetas con entrega esta semana…”</p>
                        </div>
                    </details>

                    <details class="accordion">
                        <summary>
                            <div class="acc-title">
                                <b>3) Ritmo</b>
                                <span>1–2 mensajes/día por grupo</span>
                            </div>
                            <div class="acc-ico" aria-hidden="true">⌁</div>
                        </summary>
                        <div class="acc-body">
                            <ul>
                                <li>Ideal: 1 cada 6–12 horas.</li>
                                <li>PROMO: máx 1 cada 3 contenidos.</li>
                                <li>Silencio no es fracaso: acumula emoción.</li>
                            </ul>
                        </div>
                    </details>

                    <details class="accordion">
                        <summary>
                            <div class="acc-title">
                                <b>4) Señales de control</b>
                                <span>Health vs alarma</span>
                            </div>
                            <div class="acc-ico" aria-hidden="true">⌁</div>
                        </summary>
                        <div class="acc-body">
                            <p><b>Señales sanas</b>: respuestas espontáneas, reaparecen días después, preguntas cruzadas.</p>
                            <p><b>Alarmas</b>: visto sin respuestas + PROMO, solo 👍, abandono tras promo.</p>
                            <p class="muted">Si hay alarma: reset narrativo con <span class="tag accent">IDENTITY</span>.</p>
                        </div>
                    </details>

                    <details class="accordion">
                        <summary>
                            <div class="acc-title">
                                <b>5) KPI correctos</b>
                                <span>Lo que se mide</span>
                            </div>
                            <div class="acc-ico" aria-hidden="true">⌁</div>
                        </summary>
                        <div class="acc-body">
                            <ul>
                                <li>% de mensajes con respuesta</li>
                                <li>Tiempo hasta primera respuesta</li>
                                <li>Personas que reaparecen</li>
                                <li>Preguntas directas sobre camisetas (pull, no push)</li>
                            </ul>
                        </div>
                    </details>

                    <div class="sep"></div>

                    <div class="note">
                        <strong>Regla final:</strong> si ese mensaje no lo diría un amigo colombiano en el grupo, no se publica.
                    </div>
                </div>

                <!-- Ops -->
                <div id="paneOps" class="tabpane" role="tabpanel" aria-labelledby="tabOps">
                    <div class="grid2">
                        <div class="kpi">
                            <div class="t">Memoria vital</div>
                            <div class="n"><span id="savedCount">0</span></div>
                            <div class="s">Items guardados (localStorage)</div>
                        </div>
                        <div class="kpi">
                            <div class="t">Última acción</div>
                            <div class="n" style="font-size:13px"><span id="lastAction">—</span></div>
                            <div class="s">ISO timestamp</div>
                        </div>
                    </div>

                    <div class="sep"></div>

                    <div class="row">
                        <button class="btn primary" id="saveState">Guardar estado</button>
                        <button class="btn" id="exportJson">Exportar JSON</button>
                        <button class="btn danger" id="resetState">Reset</button>
                    </div>

                    <small class="muted">
                        Guardado local (localStorage). Sirve como “memoria vital” del MVP: counters + guardados + últimas ejecuciones.
                    </small>

                    <div class="sep"></div>

                    <div class="note">
                        <strong>Atajos:</strong> presiona <span class="kbd">/</span> para enfocar búsqueda.
                    </div>
                </div>
            </div>
        </section>

        <!-- CENTER: Infinite feed -->
        <section class="card" aria-label="Feed con scroll infinito">
            <div class="card-h">
                <div>
                    <h2>Feed (Scroll Infinito)</h2>
                    <small>Relevancia → conversación → CTA (sin spam)</small>
                </div>
                <span class="tag warn">Simulación</span>
            </div>

            <div class="feed" id="feed" role="region" aria-label="Feed de contenido" tabindex="0">
                <!-- items injected by JS -->
            </div>
        </section>

        <!-- RIGHT: Charts + Diagram -->
        <aside class="card rightcol" aria-label="Insights y diagrama">
            <div class="card-h">
                <div>
                    <h2>Insights</h2>
                    <small>Por qué la mezcla reduce rechazo y empuja respuestas</small>
                </div>
                <span class="tag good">UI/UX</span>
            </div>

            <div class="card-b col">
                <!-- Diagram -->
                <div>
                    <div class="row" style="justify-content:space-between">
                        <div class="muted">Diagrama de flujo (MVP)</div>
                        <span class="tag mono" id="diagramMode">2→1 rule</span>
                    </div>

                    <div class="svgbox" aria-label="Diagrama">
                        <svg viewBox="0 0 760 230" width="100%" height="230" role="img" aria-label="Diagrama de flujo MVP">
                            <defs>
                                <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
                                    <stop offset="0" stop-color="rgba(124,92,255,0.55)" />
                                    <stop offset="1" stop-color="rgba(45,212,255,0.45)" />
                                </linearGradient>
                            </defs>

                            <rect x="18" y="22" rx="16" ry="16" width="210" height="76" fill="rgba(0,0,0,.18)" stroke="rgba(255,255,255,.12)" />
                            <text x="38" y="52" fill="white" font-size="14" font-weight="800">Detectar destino</text>
                            <text x="38" y="73" fill="rgba(159,176,212,.95)" font-size="12">grupo/persona + estado</text>

                            <rect x="276" y="22" rx="16" ry="16" width="210" height="76" fill="rgba(0,0,0,.18)" stroke="rgba(255,255,255,.12)" />
                            <text x="296" y="52" fill="white" font-size="14" font-weight="800">Elegir intención</text>
                            <text x="296" y="73" fill="rgba(159,176,212,.95)" font-size="12">IDENTITY/CURRENT/COMMUNITY</text>

                            <rect x="534" y="22" rx="16" ry="16" width="210" height="76" fill="rgba(0,0,0,.18)" stroke="rgba(255,255,255,.12)" />
                            <text x="554" y="52" fill="white" font-size="14" font-weight="800">Abrir conversación</text>
                            <text x="554" y="73" fill="rgba(159,176,212,.95)" font-size="12">pregunta + emoción</text>

                            <rect x="276" y="132" rx="16" ry="16" width="210" height="76" fill="url(#g1)" stroke="rgba(255,255,255,.14)" />
                            <text x="296" y="162" fill="white" font-size="14" font-weight="900">Regla 2→1</text>
                            <text x="296" y="183" fill="rgba(232,238,252,.92)" font-size="12">2 news antes de 1 promo</text>

                            <rect x="534" y="132" rx="16" ry="16" width="210" height="76" fill="rgba(255,255,255,.05)" stroke="rgba(255,255,255,.14)" />
                            <text x="554" y="162" fill="white" font-size="14" font-weight="800">CTA natural</text>
                            <text x="554" y="183" fill="rgba(159,176,212,.95)" font-size="12">camisetas + link + urgencia</text>

                            <path d="M 228 60 L 276 60" stroke="rgba(255,255,255,.22)" stroke-width="2" fill="none" />
                            <polygon points="276,60 268,56 268,64" fill="rgba(255,255,255,.22)" />

                            <path d="M 486 60 L 534 60" stroke="rgba(255,255,255,.22)" stroke-width="2" fill="none" />
                            <polygon points="534,60 526,56 526,64" fill="rgba(255,255,255,.22)" />

                            <path d="M 381 98 L 381 132" stroke="rgba(255,255,255,.22)" stroke-width="2" fill="none" />
                            <polygon points="381,132 377,124 385,124" fill="rgba(255,255,255,.22)" />

                            <path d="M 486 170 L 534 170" stroke="rgba(255,255,255,.22)" stroke-width="2" fill="none" />
                            <polygon points="534,170 526,166 526,174" fill="rgba(255,255,255,.22)" />
                        </svg>
                    </div>

                    <div class="legend">
                        <span><span class="dot" style="background:rgba(124,92,255,.85)"></span> Conversación</span>
                        <span><span class="dot" style="background:rgba(45,212,255,.85)"></span> Relevancia</span>
                        <span><span class="dot" style="background:rgba(61,220,151,.85)"></span> CTA “natural”</span>
                    </div>
                </div>

                <div class="sep"></div>

                <!-- Charts -->
                <div class="grid2">
                    <div class="kpi">
                        <div class="t">Mix objetivo</div>
                        <div class="n"><span id="mixLabel">66%</span></div>
                        <div class="s">News vs Promo (por regla 2→1)</div>
                    </div>
                    <div class="kpi">
                        <div class="t">Riesgo de rechazo</div>
                        <div class="n"><span id="riskLabel">Bajo</span></div>
                        <div class="s">Si cumples “news antes de promo”</div>
                    </div>
                </div>

                <div class="row" style="gap:12px">
                    <div class="svgbox" style="flex:1">
                        <div class="muted" style="margin:2px 0 8px">Distribución por intención (simulada)</div>
                        <svg id="donut" viewBox="0 0 240 160" width="100%" height="160" aria-label="Donut de distribución"></svg>
                    </div>
                    <div class="svgbox" style="flex:1">
                        <div class="muted" style="margin:2px 0 8px">Efecto en “tolerancia” (simulada)</div>
                        <svg id="bars" viewBox="0 0 240 160" width="100%" height="160" aria-label="Barras de tolerancia"></svg>
                    </div>
                </div>

                <div class="sep"></div>

                <div class="note">
                    <strong>Interpretación (MVP):</strong>
                    mezcla “noticia conversacional” antes de promo para reducir percepción de spam y aumentar respuestas.
                    La venta entra como consecuencia (“para los que preguntan…”), no como interrupción.
                </div>
            </div>
        </aside>
    </main>

    <div class="toast" id="toast" role="status" aria-live="polite">
        <p class="t" id="toastT">Guardado</p>
        <p class="m" id="toastM">Estado actualizado en localStorage.</p>
    </div>

    <script>
    // ============================================================
    // DATA (del HTML original, preservado) + mejoras de UX
    // ============================================================

    const SEED = [
      { type:"IDENTITY", title:"Orgullo: la Tricolor se siente igual", body:"Estemos donde estemos 🇨🇴. ¿Cuál fue tu camiseta más inolvidable (año/torneo)?" , tags:["colombia","nostalgia"], source:"Tricolor Fan Club", cta:null },
      { type:"CURRENT", title:"Actualidad: conversación primero", body:"Pregunta rápida: si hoy hubiera partido, ¿a quién pones de 9? (sin pelear 😄)" , tags:["seleccion","debate"], source:"Social prompt", cta:null },
      { type:"COMMUNITY", title:"Comunidad en el exterior", body:"Vancouver: ¿en qué zona te queda mejor un watch party? (Burnaby / Downtown / Surrey)" , tags:["vancouver","watch-party"], source:"Tricolor Fan Club", cta:null },
      { type:"PROMO", title:"Camisetas (CTA natural)", body:"Para los que preguntan 👕: camisetas de Colombia con entrega en Vancouver esta semana. Link en el mensaje fijado." , tags:["camisetas","venta"], source:"Tricolor Fan Club", cta:{label:"Abrir promo", link:"https://www.instagram.com/tricolorfanclub/"} },

      { type:"IDENTITY", title:"Historia: momentos isla", body:"Goles que no se olvidan: si pudieras revivir uno en pantalla gigante, ¿cuál sería?" , tags:["historia","orgullo"], source:"TFC", cta:null },
      { type:"CURRENT", title:"Actualidad emocional", body:"Si sale una convocatoria sorpresiva, ¿prefieres juventud o experiencia? ¿Por qué?" , tags:["convocatoria","debate"], source:"Social prompt", cta:null },
      { type:"COMMUNITY", title:"Orgullo afuera", body:"¿Cuál es el mejor lugar en tu ciudad para ver un partido sin perder el ambiente colombiano?" , tags:["canada","comunidad"], source:"TFC", cta:null },
      { type:"PROMO", title:"Camisetas (recordatorio suave)", body:"Si quieres camiseta antes del próximo partido/watch party, escríbeme talla + ciudad y te digo disponibilidad." , tags:["cta","stock"], source:"TFC", cta:{label:"Ver Instagram", link:"https://www.instagram.com/tricolorfanclub/"} },
    ];

    const TYPE_COLOR = {
      IDENTITY: "rgba(124,92,255,.85)",
      CURRENT: "rgba(45,212,255,.85)",
      COMMUNITY: "rgba(61,220,151,.85)",
      PROMO: "rgba(255,204,102,.90)"
    };

    // ============================================================
    // STATE (memoria vital)
    // ============================================================
    const STORAGE_KEY = "tfc_mvp_state_v2_modern";
    const defaultState = {
      counters: { IDENTITY:0, CURRENT:0, COMMUNITY:0, PROMO:0 },
      saved: [],
      lastActionAt: null
    };

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return structuredClone(defaultState);
        const s = JSON.parse(raw);
        s.counters ||= structuredClone(defaultState.counters);
        s.saved ||= [];
        s.lastActionAt ||= null;
        return s;
      }catch{
        return structuredClone(defaultState);
      }
    }
    function saveState(s){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(s, null, 2));
    }
    let state = loadState();

    // ============================================================
    // DOM
    // ============================================================
    const feedEl = document.getElementById("feed");
    const qEl = document.getElementById("q");
    const qCount = document.getElementById("qCount");
    const toast = document.getElementById("toast");
    const toastT = document.getElementById("toastT");
    const toastM = document.getElementById("toastM");

    // left ops
    const savedCountEl = document.getElementById("savedCount");
    const lastActionEl = document.getElementById("lastAction");

    // tabs
    const tabStory = document.getElementById("tabStory");
    const tabPlay  = document.getElementById("tabPlay");
    const tabOps   = document.getElementById("tabOps");
    const paneStory = document.getElementById("paneStory");
    const panePlay  = document.getElementById("panePlay");
    const paneOps   = document.getElementById("paneOps");

    // charts
    const donutEl = document.getElementById("donut");
    const barsEl  = document.getElementById("bars");
    const mixLabel = document.getElementById("mixLabel");
    const riskLabel = document.getElementById("riskLabel");

    function showToast(title, msg){
      toastT.textContent = title;
      toastM.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toast.classList.remove("show"), 2200);
    }

    function escapeHtml(s){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    function badgeFor(type){
      const dot = `<span class="dot" style="background:${TYPE_COLOR[type] || 'rgba(255,255,255,.3)'}"></span>`;
      return `<span class="badge">${dot}<span class="mono">${escapeHtml(type)}</span></span>`;
    }

    function renderItem(item, index){
      const tags = item.tags.map(t=>`<span class="tag mono">#${escapeHtml(t)}</span>`).join(" ");
      const time = new Date(Date.now() - (index* 7 * 60000)).toLocaleString();
      const cta = item.cta
        ? `<button class="btn primary" data-act="cta" data-link="${escapeHtml(item.cta.link)}">📣 ${escapeHtml(item.cta.label)}</button>`
        : "";
      return `
        <article class="feed-item" data-type="${item.type}" data-title="${escapeHtml(item.title)}" data-body="${escapeHtml(item.body)}">
          <div class="feed-top">
            <div>
              <p class="feed-title">${escapeHtml(item.title)}</p>
              <div class="feed-meta">
                ${badgeFor(item.type)}
                <span class="mono">•</span>
                <span>${escapeHtml(item.source)}</span>
                <span class="mono">•</span>
                <time>${time}</time>
              </div>
            </div>
            <span class="tag mono">#${String(index+1).padStart(4,"0")}</span>
          </div>
          <div class="feed-body">${escapeHtml(item.body)}</div>
          <div class="feed-meta" style="margin-bottom:10px">${tags}</div>
          <div class="feed-actions">
            <button class="btn" data-act="save">💾 Guardar</button>
            <button class="btn ghost" data-act="copy">📋 Copiar</button>
            ${cta}
          </div>
        </article>
      `;
    }

    // ============================================================
    // INFINITE SCROLL (estático simulado)
    // ============================================================
    let activeFilter = "ALL";
    let page = 0;
    const PAGE_SIZE = 10;

    function genItem(i){
      const base = SEED[i % SEED.length];
      const variants = [
        base.body,
        base.body + " (responde con 1 frase)",
        base.body.replace("Vancouver", "Vancouver/BC"),
      ];
      const v = variants[i % variants.length];
      return { ...base, body: v };
    }

    function matches(item, query){
      if(activeFilter !== "ALL" && item.type !== activeFilter) return false;
      if(!query) return true;
      const s = (item.title + " " + item.body + " " + item.tags.join(" ")).toLowerCase();
      return s.includes(query.toLowerCase());
    }

    function appendMore(){
      const query = qEl ? (qEl.value || "").trim() : "";
      const start = page * PAGE_SIZE;
      let added = 0;
      let html = "";

      for(let i=start; i<start + 240 && added < PAGE_SIZE; i++){
        const item = genItem(i);
        if(matches(item, query)){
          html += renderItem(item, i);
          added++;
        }
      }

      page++;
      feedEl.insertAdjacentHTML("beforeend", html);

      if(qCount){
        const q = query ? query.length : 0;
        qCount.textContent = q;
      }

      updateCharts();
      updateOps();
    }

    function resetFeed(){
      page = 0;
      feedEl.innerHTML = "";
      appendMore();
      appendMore();
      appendMore();
      feedEl.scrollTop = 0;
    }

    feedEl.addEventListener("scroll", () => {
      const nearBottom = feedEl.scrollTop + feedEl.clientHeight >= feedEl.scrollHeight - 240;
      if(nearBottom) appendMore();
    });

    if(qEl){
      qEl.addEventListener("input", () => resetFeed());
    }

    // "/" focuses search
    window.addEventListener("keydown", (e) => {
      if(e.key === "/" && document.activeElement !== qEl){
        e.preventDefault();
        qEl?.focus();
      }
    });

    // filter pills (mouse + keyboard)
    function setFilter(filter){
      activeFilter = filter;
      document.querySelectorAll(".pill").forEach(x=>{
        const on = x.dataset.filter === filter;
        x.classList.toggle("on", on);
        x.setAttribute("aria-pressed", on ? "true" : "false");
      });
      resetFeed();
    }

    document.querySelectorAll(".pill").forEach(p => {
      p.addEventListener("click", () => setFilter(p.dataset.filter));
      p.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          setFilter(p.dataset.filter);
        }
      });
    });

    // feed actions
    feedEl.addEventListener("click", async (e) => {
      const btn = e.target.closest("button");
      if(!btn) return;

      const act = btn.dataset.act;
      const itemEl = btn.closest(".feed-item");
      if(!itemEl) return;

      const type = itemEl.dataset.type;
      const title = itemEl.dataset.title;
      const body = itemEl.dataset.body;

      if(act === "save"){
        state.saved.unshift({ type, title, body, savedAt: new Date().toISOString() });
        state.saved = state.saved.slice(0, 200);
        state.counters[type] = (state.counters[type] || 0) + 1;
        state.lastActionAt = new Date().toISOString();
        saveState(state);
        showToast("Guardado", "Se guardó como contenido vital (localStorage).");
        updateCharts();
        updateOps();
      }

      if(act === "copy"){
        const txt = `${title}\n\n${body}`;
        try{
          await navigator.clipboard.writeText(txt);
          showToast("Copiado", "Texto copiado al portapapeles.");
        }catch{
          showToast("Copiado (manual)", "Tu navegador bloqueó clipboard. Selecciona y copia.");
        }
      }

      if(act === "cta"){
        const link = btn.dataset.link;
        window.open(link, "_blank", "noopener,noreferrer");
      }
    });

    // ============================================================
    // LEFT: Tabs
    // ============================================================
    function setTab(name){
      const map = {
        story: {tab:tabStory, pane:paneStory},
        play:  {tab:tabPlay,  pane:panePlay},
        ops:   {tab:tabOps,   pane:paneOps},
      };
      Object.values(map).forEach(x=>{
        const on = x === map[name];
        x.tab.classList.toggle("on", on);
        x.tab.setAttribute("aria-selected", on ? "true" : "false");
        x.pane.classList.toggle("on", on);
      });
    }
    tabStory.addEventListener("click", () => setTab("story"));
    tabPlay.addEventListener("click",  () => setTab("play"));
    tabOps.addEventListener("click",   () => setTab("ops"));

    // ============================================================
    // OPS buttons
    // ============================================================
    document.getElementById("saveState").addEventListener("click", () => {
      state.lastActionAt = new Date().toISOString();
      saveState(state);
      showToast("Guardado", "Estado del MVP guardado en localStorage.");
      updateOps();
    });

    document.getElementById("exportJson").addEventListener("click", async () => {
      const blob = new Blob([JSON.stringify(state, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "tfc_mvp_state.json";
      a.click();
      URL.revokeObjectURL(url);
      showToast("Exportado", "Se descargó el JSON con la memoria vital.");
    });

    document.getElementById("resetState").addEventListener("click", () => {
      localStorage.removeItem(STORAGE_KEY);
      state = loadState();
      showToast("Reset", "Memoria local reiniciada.");
      updateCharts();
      updateOps();
    });

    function updateOps(){
      savedCountEl.textContent = String((state.saved || []).length);
      lastActionEl.textContent = state.lastActionAt ? state.lastActionAt : "—";
    }

    // ============================================================
    // CHARTS (SVG)
    // ============================================================
    function sumCounters(){
      const c = state.counters || {};
      return {
        IDENTITY: c.IDENTITY||0,
        CURRENT: c.CURRENT||0,
        COMMUNITY: c.COMMUNITY||0,
        PROMO: c.PROMO||0
      };
    }

    function updateCharts(){
      const c = sumCounters();
      const total = c.IDENTITY + c.CURRENT + c.COMMUNITY + c.PROMO || 1;

      const news = c.IDENTITY + c.CURRENT + c.COMMUNITY;
      const newsPct = Math.round((news / total) * 100);
      mixLabel.textContent = `${newsPct}%`;

      const promoPct = Math.round((c.PROMO / total) * 100);
      let risk = "Bajo";
      if(promoPct > 45) risk = "Alto";
      else if(promoPct > 30) risk = "Medio";
      riskLabel.textContent = risk;

      drawDonut(donutEl, [
        { label:"IDENTITY", value:c.IDENTITY, color: TYPE_COLOR.IDENTITY },
        { label:"CURRENT", value:c.CURRENT, color: TYPE_COLOR.CURRENT },
        { label:"COMMUNITY", value:c.COMMUNITY, color: TYPE_COLOR.COMMUNITY },
        { label:"PROMO", value:c.PROMO, color: TYPE_COLOR.PROMO }
      ]);

      drawBars(barsEl, [
        { label:"Tolerancia", value: Math.max(10, 95 - promoPct), color:"rgba(61,220,151,.85)" },
        { label:"Rechazo", value: Math.min(90, promoPct + 10), color:"rgba(255,92,122,.75)" }
      ]);
    }

    function drawDonut(svg, slices){
      const cx=80,cy=80,r=54,ir=32;
      svg.innerHTML = "";
      const total = slices.reduce((a,s)=>a+(s.value||0),0) || 1;
      let ang = -Math.PI/2;

      svg.insertAdjacentHTML("beforeend",
        `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="rgba(255,255,255,.08)" stroke-width="${r-ir}"></circle>`
      );

      slices.forEach(s=>{
        const v = (s.value||0);
        const a = (v/total) * Math.PI*2;
        if(v<=0) return;
        const x1 = cx + r*Math.cos(ang);
        const y1 = cy + r*Math.sin(ang);
        const x2 = cx + r*Math.cos(ang+a);
        const y2 = cy + r*Math.sin(ang+a);
        const large = a > Math.PI ? 1 : 0;

        const path = `
          <path d="M ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2}"
                fill="none" stroke="${s.color}" stroke-width="${r-ir}" stroke-linecap="butt" opacity="0.95"></path>`;
        svg.insertAdjacentHTML("beforeend", path);
        ang += a;
      });

      svg.insertAdjacentHTML("beforeend",
        `<text x="${cx}" y="${cy-4}" text-anchor="middle" fill="white" font-size="13" font-weight="900">${(state.saved||[]).length}</text>
         <text x="${cx}" y="${cy+14}" text-anchor="middle" fill="rgba(159,176,212,.95)" font-size="11">guardados</text>`
      );

      const lx=150, ly=22, lh=28;
      slices.forEach((s,i)=>{
        const pct = Math.round(((s.value||0)/total)*100);
        svg.insertAdjacentHTML("beforeend",
          `<rect x="${lx}" y="${ly+i*lh}" width="10" height="10" rx="4" fill="${s.color}" opacity="0.95"></rect>
           <text x="${lx+16}" y="${ly+9+i*lh}" fill="rgba(232,238,252,.92)" font-size="11" font-family="ui-monospace">${s.label}</text>
           <text x="${lx+88}" y="${ly+9+i*lh}" fill="rgba(159,176,212,.95)" font-size="11">${pct}%</text>`
        );
      });
    }

    function drawBars(svg, bars){
      const W=240,H=160, x0=20, y0=130, maxH=90, bw=60, gap=28;
      svg.innerHTML="";
      svg.insertAdjacentHTML("beforeend",
        `<line x1="${x0}" y1="${y0}" x2="${W-16}" y2="${y0}" stroke="rgba(255,255,255,.12)"/>
         <line x1="${x0}" y1="${y0-maxH-10}" x2="${x0}" y2="${y0}" stroke="rgba(255,255,255,.12)"/>`
      );

      bars.forEach((b,i)=>{
        const h = Math.max(0, Math.min(100, b.value)) * (maxH/100);
        const x = x0 + 14 + i*(bw+gap);
        const y = y0 - h;
        svg.insertAdjacentHTML("beforeend",
          `<rect x="${x}" y="${y}" width="${bw}" height="${h}" rx="12" fill="${b.color}" opacity="0.9"></rect>
           <text x="${x+bw/2}" y="${y0+18}" text-anchor="middle" fill="rgba(159,176,212,.95)" font-size="11">${b.label}</text>
           <text x="${x+bw/2}" y="${y-6}" text-anchor="middle" fill="rgba(232,238,252,.92)" font-size="11" font-family="ui-monospace">${Math.round(b.value)}%</text>`
        );
      });
    }

    // ============================================================
    // INIT
    // ============================================================
    updateOps();
    resetFeed();
    updateCharts();
    </script>
</body>
</html>
